import{t as W}from"./chunk-NHSTBDMI.js";import"./chunk-4MNFZP5U.js";import{$a as d,Cb as P,Eb as h,Fb as M,Ib as z,Kb as B,Lb as O,Ma as u,Na as y,T as w,Ub as L,Y as G,Za as C,aa as A,d as k,db as a,eb as r,ec as U,fb as V,fc as q,g as S,gb as D,gc as $,hb as N,ia as f,ib as b,ja as _,jb as j,kb as v,kc as Y,lb as R,mc as H,nc as J,oa as F,pa as T,sc as Q,tb as E,ub as l,vb as K,wb as x}from"./chunk-FTRD6JFR.js";var X=(()=>{let o=class o{constructor(e){this.navigator=e,this.eventOnInit=new T,this.eventSignedIn=new T,this.inited={gapi:!1,gis:!1},e.importTag({type:"script",src:"https://apis.google.com/js/api.js",onload:()=>this.onImport("gapi")}),e.importTag({type:"script",src:"https://accounts.google.com/gsi/client",onload:()=>this.onImport("gis")})}get enabled(){return this.inited.gapi&&this.inited.gis}set auth(e){this._auth=e,typeof gapi<"u"&&e.apiKey!=""&&this.onloadGapi(e),typeof google<"u"&&e.clientId!=""&&this.onloadGis(e)}onImport(e){let n=this._auth;if(!(typeof n>"u"))switch(e){case"gapi":this.onloadGapi(n);break;case"gis":this.onloadGis(n);break}}onloadGapi(e){let n=()=>this.initializeGapiClient(e);try{gapi.load("client",n)}catch(i){console.log(i)}}initializeGapiClient(e){return k(this,null,function*(){yield gapi.client.init({apiKey:e.apiKey,discoveryDocs:["https://sheets.googleapis.com/$discovery/rest?version=v4"]}),this.inited.gapi=!0,this.onLoaded()})}onloadGis(e){let n=["https://www.googleapis.com/auth/spreadsheets.readonly","https://www.googleapis.com/auth/spreadsheets"];try{this.tokenClient=google.accounts.oauth2.initTokenClient({client_id:e.clientId,scope:n.join(" "),callback:""}),this.inited.gis=!0,this.onLoaded()}catch(i){console.log(i)}}onLoaded(){this.eventOnInit.emit(this.inited)}signIn(){if(!this.enabled){console.warn("Script not loaded yet!");return}this.tokenClient.callback=e=>k(this,null,function*(){if(e.error!==void 0)throw this.eventSignedIn.emit({status:!1,result:e.error}),e;let n={access_token:e.access_token,expires_in:e.expires_in,token_type:e.token_type,scope:e.scope.split(" ")};this.eventSignedIn.emit({status:!0,result:n})}),this.tokenClient.requestAccessToken({prompt:""})}signOut(){let e=gapi.client.getToken();e!==null&&(google.accounts.oauth2.revoke(e.access_token),gapi.client.setToken(""))}getBatch(e,n){return new S(i=>{gapi.client.sheets.spreadsheets.values.batchGet({spreadsheetId:e,dateTimeRenderOption:"FORMATTED_STRING",valueRenderOption:"UNFORMATTED_VALUE",ranges:n}).then(s=>{i.next(s.result),i.complete()}).catch(s=>{i.error(s)})})}stringToList(e,n="	"){let i=e.split(`\r
`),s=[];return i.forEach(m=>{let p=[];m.split(n).forEach(g=>{let I=g.trim()!=""&&!isNaN(Number(g));p.push(I?Number(g):g)}),s.push(p)}),s}listToObject(e){let n=[];e[0].forEach(s=>{let m=s.replace(/\s/g,"");n.push(m)});let i=[];return e.forEach((s,m)=>{if(m==0)return;let p={id:m};s.forEach((g,I)=>{p[n[I]]=g}),i.push(p)}),i}};o.\u0275fac=function(n){return new(n||o)(G(Q))},o.\u0275prov=w({token:o,factory:o.\u0275fac,providedIn:"root"});let t=o;return t})();var Z=t=>({bool:t}),te=t=>({disabled:t}),ie=t=>({name:"Bearer",value:t}),ne=t=>({name:"Access Token",value:t}),oe=t=>({name:"Expires",value:t}),se=(t,o)=>({"bi-check text-success":t,"bi-x text-danger":o});function ae(t,o){if(t&1&&(D(0),a(1,"li",22),l(2),r(),N()),t&2){let c=o.$implicit;u(2),x(" ",c," ")}}function re(t,o){if(t&1&&(a(0,"section",17)(1,"h2"),l(2,"Result :"),r(),a(3,"div"),b(4,9)(5,9)(6,9),z(7,"number"),a(8,"div",5)(9,"div",18),l(10," Scopes: "),r(),a(11,"ul"),C(12,ae,3,1,"ng-container",19),r()()(),a(13,"div",20)(14,"a",21),l(15," Continue "),r()()()),t&2){let c=R(),e=E(30);u(4),d("ngTemplateOutlet",e)("ngTemplateOutletContext",h(12,ie,c.token.token_type)),u(),d("ngTemplateOutlet",e)("ngTemplateOutletContext",h(14,ne,c.token.access_token)),u(),d("ngTemplateOutlet",e)("ngTemplateOutletContext",h(16,oe,B(7,8,c.token.expires_in,"1.0","id-ID")+" seconds")),u(6),d("ngForOf",c.token.scope)("ngForTrackBy",c.app.tracker)}}function le(t,o){if(t&1&&(a(0,"div",5)(1,"div",18),l(2),r(),a(3,"div",23),l(4),r()()),t&2){let c=o.name,e=o.value;u(2),x("",c," :"),u(2),K(e)}}function pe(t,o){if(t&1&&V(0,"i",24),t&2){let c=o.bool;d("ngClass",M(1,se,c,!c))}}var be=(()=>{let o=class o{constructor(e,n,i,s){this.el=e,this.app=n,this.gs=i,this.cd=s,this.auth={apiKey:"",clientId:"",useOauth:!1},this.plugin={gapi:!1,gis:!1}}ngOnInit(){this.onEvents()}onEvents(){this.gs.eventOnInit.subscribe(e=>{this.plugin.gapi=e.gapi,e.gis&&setTimeout(()=>{this.gs.signIn()},100),this.cd.detectChanges()}),this.gs.eventSignedIn.subscribe(e=>{this.plugin.gis=e.status,e.status&&(this.token=e.result),this.cd.detectChanges()})}onAuthorize(e){e.preventDefault(),this.gs.auth={apiKey:this.auth.apiKey,clientId:this.auth.clientId,storageName:"gtoken"}}};o.\u0275fac=function(n){return new(n||o)(y(F),y(W),y(X),y(L))},o.\u0275cmp=A({type:o,selectors:[["app-gsheets"]],standalone:!0,features:[P],decls:33,vars:12,consts:[["tokenResult",""],["check",""],[1,"container"],["href","https://console.cloud.google.com/apis/credentials","rel","noopener","target","_blank","title","Google Cloud APIS Credentials page"],[3,"submit","input"],[1,"mb-3"],["for","api"],[1,"hstack"],["type","text","name","api","id","api","title","API Key","required","","placeholder","Insert Google API Key...",1,"form-control",3,"input"],[3,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"form-check"],["type","checkbox","name","oauth2","id","oauth2","title","Enable OAuth2 Mode",1,"form-check-input",3,"input"],["for","oauth2",1,"form-check-label"],["type","text","name","clientid","id","clientid","title","Client ID","placeholder","Insert User Client ID...",1,"form-control",3,"input","ngClass"],[1,"justify-content-center","d-flex"],["type","submit","name","connect","id","connect",1,"btn","btn-primary"],["class","border rounded p-3 my-3 bg-body-secondary",4,"ngIf"],[1,"border","rounded","p-3","my-3","bg-body-secondary"],[1,"fw-medium"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"text-end"],["href","",1,"btn","btn-primary","disabled"],[1,"text-truncate"],[1,"ms-3","text-truncate"],[1,"bi",3,"ngClass"]],template:function(n,i){if(n&1){let s=j();a(0,"section",2)(1,"h1"),l(2,"API Authorization"),r(),a(3,"article")(4,"p"),l(5,"This section is to test the connection of your API key."),r(),a(6,"p"),l(7," You can create/select your API here : "),a(8,"a",3),l(9," Google Cloud APIS (Credentials) "),r()()(),a(10,"form",4),v("submit",function(p){return f(s),_(i.onAuthorize(p))})("input",function(){return f(s),_(i.token=void 0)}),a(11,"div",5)(12,"label",6),l(13,"API Key"),r(),a(14,"div",7)(15,"input",8),v("input",function(p){return f(s),_(i.auth.apiKey=i.app.navigator.inputValue(p,"string"))}),r(),b(16,9),r()(),a(17,"div",5)(18,"div",10)(19,"input",11),v("input",function(p){return f(s),_(i.auth.useOauth=i.app.navigator.inputValue(p,"bool"))}),r(),a(20,"label",12),l(21,"Client ID"),r()(),a(22,"div",7)(23,"input",13),v("input",function(p){return f(s),_(i.auth.clientId=i.app.navigator.inputValue(p,"string"))}),r(),b(24,9),r()(),a(25,"div",14)(26,"button",15),l(27," Connect "),r()()(),C(28,re,16,18,"section",16),r(),C(29,le,5,2,"ng-template",null,0,O)(31,pe,1,4,"ng-template",null,1,O)}if(n&2){let s=E(32);u(16),d("ngTemplateOutlet",s)("ngTemplateOutletContext",h(6,Z,i.plugin.gapi)),u(7),d("ngClass",h(8,te,!i.auth.useOauth)),u(),d("ngTemplateOutlet",s)("ngTemplateOutletContext",h(10,Z,i.plugin.gis)),u(4),d("ngIf",i.token!=null)}},dependencies:[J,U,q,$,Y,H]});let t=o;return t})();export{be as GsheetsComponent};
