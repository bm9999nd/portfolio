import{m as M}from"./chunk-UHD3QEGW.js";import{$a as S,Bb as x,Ia as f,Ja as d,Kb as D,R as k,Ua as E,V as T,Wa as m,Wb as K,Z as w,Za as a,_a as r,bc as F,cb as b,d as I,db as G,dc as P,ea as u,eb as g,fa as h,g as _,ic as R,ka as O,la as C,nb as A,ob as c,tb as V,vb as y,wb as j}from"./chunk-B23K2YXN.js";var N=(()=>{let n=class n{constructor(e){this.navigator=e,this.eventOnInit=new C,this.eventSignedIn=new C,this.inited={gapi:!1,gis:!1},e.importTag({type:"script",src:"https://apis.google.com/js/api.js",onload:()=>this.onImport("gapi")}),e.importTag({type:"script",src:"https://accounts.google.com/gsi/client",onload:()=>this.onImport("gis")})}get enabled(){return this.inited.gapi&&this.inited.gis}set auth(e){this._auth=e,typeof gapi<"u"&&e.apiKey!=""&&this.onloadGapi(e),typeof google<"u"&&e.clientId!=""&&this.onloadGis(e)}onImport(e){let i=this._auth;if(!(typeof i>"u"))switch(e){case"gapi":this.onloadGapi(i);break;case"gis":this.onloadGis(i);break}}onloadGapi(e){let i=()=>this.initializeGapiClient(e);try{gapi.load("client",i)}catch(t){console.log(t)}}initializeGapiClient(e){return I(this,null,function*(){yield gapi.client.init({apiKey:e.apiKey,discoveryDocs:["https://sheets.googleapis.com/$discovery/rest?version=v4"]}),this.inited.gapi=!0,this.onLoaded()})}onloadGis(e){let i=["https://www.googleapis.com/auth/spreadsheets.readonly","https://www.googleapis.com/auth/spreadsheets"];try{this.tokenClient=google.accounts.oauth2.initTokenClient({client_id:e.clientId,scope:i.join(" "),callback:""}),this.inited.gis=!0,this.onLoaded()}catch(t){console.log(t)}}onLoaded(){this.eventOnInit.emit(this.inited)}signIn(){if(!this.enabled){alert("Script not loaded yet!");return}this.tokenClient.callback=e=>I(this,null,function*(){if(e.error!==void 0)throw this.eventSignedIn.emit(!1),e;this.eventSignedIn.emit(!0)}),this.tokenClient.requestAccessToken({prompt:""})}signOut(){let e=gapi.client.getToken();e!==null&&(google.accounts.oauth2.revoke(e.access_token),gapi.client.setToken(""))}getBatch(e,i){return new _(t=>{gapi.client.sheets.spreadsheets.values.batchGet({spreadsheetId:e,dateTimeRenderOption:"FORMATTED_STRING",valueRenderOption:"UNFORMATTED_VALUE",ranges:i}).then(o=>{t.next(o.result),t.complete()}).catch(o=>{t.error(o)})})}listToObject(e){let i=[];e[0].forEach(o=>{let p=o.toLowerCase().replace(/\s/g,"");i.push(p)});let t=[];return e.forEach((o,p)=>{if(p==0)return;let l={id:p};o.forEach((L,U)=>{l[i[U]]=L}),t.push(l)}),t}};n.\u0275fac=function(i){return new(i||n)(T(R))},n.\u0275prov=k({token:n,factory:n.\u0275fac,providedIn:"root"});let s=n;return s})();var z=s=>({bool:s}),B=s=>({disabled:s}),Y=(s,n)=>({"bi-check text-success":s,"bi-x text-danger":n});function $(s,n){if(s&1&&S(0,"i",15),s&2){let v=n.bool;m("ngClass",j(1,Y,v,!v))}}var se=(()=>{let n=class n{constructor(e,i,t,o){this.el=e,this.app=i,this.gs=t,this.cd=o,this.auth={apiKey:"",clientId:"",useOauth:!1},this.plugin={gapi:!1,gis:!1}}ngOnInit(){this.gs.eventOnInit.subscribe(e=>{this.plugin.gapi=e.gapi,e.gis&&this.gs.signIn(),this.cd.detectChanges()}),this.gs.eventSignedIn.subscribe(e=>{this.plugin.gis=e,this.cd.detectChanges()})}onAuthorize(e){e.preventDefault(),this.gs.auth={apiKey:this.auth.apiKey,clientId:this.auth.clientId,storageName:"gtoken"}}};n.\u0275fac=function(i){return new(i||n)(d(O),d(M),d(N),d(D))},n.\u0275cmp=w({type:n,selectors:[["app-gsheets"]],standalone:!0,features:[V],decls:30,vars:11,consts:[["check",""],[1,"container"],["href","https://console.cloud.google.com/apis/credentials","rel","noopener","target","_blank","title","Google Cloud APIS Credentials page"],[3,"submit"],[1,"mb-3"],["for","api"],[1,"hstack"],["type","text","name","api","id","api","title","API Key","required","","placeholder","Insert Google API Key...",1,"form-control",3,"input"],[3,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"form-check"],["type","checkbox","name","oauth2","id","oauth2","title","Enable OAuth2 Mode",1,"form-check-input",3,"input"],["for","oauth2",1,"form-check-label"],["type","text","name","clientid","id","clientid","title","Client ID","placeholder","Insert User Client ID...",1,"form-control",3,"input","ngClass"],[1,"justify-content-center","d-flex"],["type","submit","name","connect","id","connect",1,"btn","btn-primary"],[1,"bi",3,"ngClass"]],template:function(i,t){if(i&1){let o=G();a(0,"section",1)(1,"h1"),c(2,"API Authorization"),r(),a(3,"article")(4,"p"),c(5,"This section is to test the connection of your API key."),r(),a(6,"p"),c(7," You can create/select your API here : "),a(8,"a",2),c(9," Google Cloud APIS (Credentials) "),r()()(),a(10,"form",3),g("submit",function(l){return u(o),h(t.onAuthorize(l))}),a(11,"div",4)(12,"label",5),c(13,"API Key"),r(),a(14,"div",6)(15,"input",7),g("input",function(l){return u(o),h(t.auth.apiKey=t.app.navigator.inputValue(l,"string"))}),r(),b(16,8),r()(),a(17,"div",4)(18,"div",9)(19,"input",10),g("input",function(l){return u(o),h(t.auth.useOauth=t.app.navigator.inputValue(l,"bool"))}),r(),a(20,"label",11),c(21,"Client ID"),r()(),a(22,"div",6)(23,"input",12),g("input",function(l){return u(o),h(t.auth.clientId=t.app.navigator.inputValue(l,"string"))}),r(),b(24,8),r()(),a(25,"div",13)(26,"button",14),c(27," Connect "),r()()()(),E(28,$,1,4,"ng-template",null,0,x)}if(i&2){let o=A(29);f(16),m("ngTemplateOutlet",o)("ngTemplateOutletContext",y(5,z,t.plugin.gapi)),f(7),m("ngClass",y(7,B,!t.auth.useOauth)),f(),m("ngTemplateOutlet",o)("ngTemplateOutletContext",y(9,z,t.plugin.gis))}},dependencies:[P,K,F]});let s=n;return s})();export{se as GsheetsComponent};
