import{a as E}from"./chunk-74BTEOFY.js";import{a as Q,f as _,n as A}from"./chunk-LYXANSDQ.js";import{$a as f,$b as M,Ea as w,Ja as p,Ka as r,Qa as x,Wa as C,Ya as u,Z as I,_a as z,ab as m,bb as h,cb as S,db as j,g as b,hb as T,hc as P,lb as g,mb as y,nb as v,ub as F}from"./chunk-XSK66XXE.js";var H=["bg"],N=["content"];function D(s,o){if(s&1&&(S(0),f(1,"div",4,0),h(3,"img",5),m(),h(4,"div",6,1),j()),s&2){let a=T();p(4),z("d-block position-absolute start-0 z-0 w-100 h-100 d-grid justify-content-center align-content-center text-center ",a.stories[a.playIndex].css,""),u("innerHTML",a.sanitized(a.stories[a.playIndex].content),w)}}var Y=(()=>{let o=class o{constructor(t,e,n,i,l){this.zone=t,this.gs=e,this.http=n,this.sanitize=i,this.app=l,this.readLine=(this.app.navigator.isDevMode,0),this.stories=[],this.app.footerFixed=!0}sanitized(t){return!this.app.navigator.isBrowser||t==null||t==null?void 0:this.sanitize.bypassSecurityTrustHtml(t)}canPlayNext(){return this.stories==null?!1:this.playIndex+1<this.stories.length}getItem(){return this.stories!=null?this.stories[this.playIndex]:null}getFade(t,e,n,i,l){let d=t.ownerDocument,c=i+l+e;return t.animate([{opacity:0,offset:0},{opacity:1,offset:i/c},{opacity:1,offset:(i+e)/c},{opacity:0,offset:1}],{duration:c,delay:n,direction:"normal",easing:"ease-in-out",fill:"both",timeline:d.timeline})}clearPlayer(t){t.getAnimations().forEach(e=>{e.commitStyles(),e.cancel()})}animating(){if(!this.app.navigator.isBrowser||(console.log("animating",this.bg),this.bg==null)||this.content==null)return;let t=1e3,e=this.getItem();if(e==null)return;let n=this.content.nativeElement,i;if(e.anim=="fade")i=this.getFade(n,e.duration,e.delay+t,e.fadeIn,e.fadeOut);else return;i.addEventListener("finish",l=>{this.clearPlayer(n),this.canPlayNext()&&(this.playIndex+=1,this.animating())}),i.play()}loadGoogle(){return new b(t=>{this.http.get("https://docs.google.com/spreadsheets/d/e/2PACX-1vTIlntZ9oxCAQ4ZcAd0h3FcHub42WxX8RqPlxCVu5Rk4PwdwWCSRiNsb58gwpXzxNsG7oK3mYw2KfCU/pub?gid=0&single=true&output=tsv",{responseType:"text"}).subscribe(n=>{let i=this.gs.stringToList(n),d=this.gs.listToObject(i).filter(c=>c.anim!="");this.stories=d,t.next(d),t.complete()})})}ngOnInit(){this.loadGoogle()}ngAfterViewInit(){this.zone.run(()=>{this.animating()})}};o.\u0275fac=function(e){return new(e||o)(r(x),r(E),r(Q),r(_),r(A))},o.\u0275cmp=I({type:o,selectors:[["app-story"]],viewQuery:function(e,n){if(e&1&&(g(H,5),g(N,5)),e&2){let i;y(i=v())&&(n.bg=i.first),y(i=v())&&(n.content=i.first)}},standalone:!0,features:[F],decls:2,vars:1,consts:[["bg",""],["content",""],[1,"w-100","h-100","position-relative","overflow-hidden"],[4,"ngIf"],[1,"position-absolute","z-n1","w-100","h-100","bg-body"],["src","","alt","",1,"img-thumbnail","bg-opacity-25"],[3,"innerHTML"]],template:function(e,n){e&1&&(f(0,"div",2),C(1,D,6,4,"ng-container",3),m()),e&2&&(p(),u("ngIf",n.stories!=null&&n.stories.length>0))},dependencies:[P,M]});let s=o;return s})();export{Y as StoryComponent};
